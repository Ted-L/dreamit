export function morph(o,r,i={}){"string"==typeof r&&(r=e(r)),new t(i).morph([o,r])}export function morphInner(o,i,d={}){"string"==typeof i&&(i=function(t){const o=e(t);if(r(o))return o;throw new Error("[Morphlex] The string was not a valid HTML element.")}(i)),new t(d).morphInner([o,i])}function e(e){const t=(new DOMParser).parseFromString(e,"text/html");if(1===t.childNodes.length)return t.body.firstChild;throw new Error("[Morphlex] The string was not a valid HTML node.")}class t{#e;#t;#o;#r;#i;#d;#s;#n;#a;#h;#l;#p;#f;#u;constructor(e={}){this.#e=new WeakMap,this.#t=new WeakMap,this.#o=e.ignoreActiveValue||!1,this.#r=e.preserveModifiedValues||!1,this.#i=e.beforeNodeMorphed,this.#d=e.afterNodeMorphed,this.#s=e.beforeNodeAdded,this.#n=e.afterNodeAdded,this.#a=e.beforeNodeRemoved,this.#h=e.afterNodeRemoved,this.#l=e.beforeAttributeUpdated,this.#p=e.afterAttributeUpdated,this.#f=e.beforePropertyUpdated,this.#u=e.afterPropertyUpdated,Object.freeze(this)}morph(e){this.#c(e[0],(()=>{(function(e){return h(e[0])&&h(e[1])})(e)&&this.#m(e),this.#N(e)}))}morphInner(e){this.#c(e[0],(()=>{if(!o(e))throw new Error("[Morphlex] You can only do an inner morph with matching elements.");this.#m(e),this.#b(e)}))}#c(e,t){if(r(e)){const o=e.ariaBusy;e.ariaBusy="true",t(),e.ariaBusy=o}else t()}#m([e,t]){this.#v(e),this.#v(t),this.#M(e),Object.freeze(this.#e),Object.freeze(this.#t)}#M(e){const t=e.querySelectorAll("audio,canvas,embed,iframe,input,object,textarea,video"),o=t.length;for(let d=0;d<o;d++){const o=t[d];let n=0;i(o)||s(o)?(n++,o.value!==o.defaultValue&&n++,o===document.activeElement&&n++):(n+=3,"video"!==(r=o).localName&&"audio"!==r.localName||o.ended||(o.paused||n++,o.currentTime>0&&n++));let a=o;for(;a&&(this.#t.set(a,(this.#t.get(a)||0)+n),a!==e);)a=a.parentElement}var r}#v(e){const t=e.querySelectorAll("[id]"),o=t.length;for(let r=0;r<o;r++){const o=t[r],i=o.id;if(""===i)continue;let d=o;for(;d;){const t=this.#e.get(d);if(t?t.add(i):this.#e.set(d,new Set([i])),d===e)break;d=d.parentElement}}}#N(e){o(e)?this.#y(e):this.#A(e)}#y(e){const[t,o]=e;(this.#i?.(t,o)??1)&&((t.hasAttributes()||o.hasAttributes())&&this.#g(e),this.#b(e),this.#d?.(t,o))}#A([e,t]){(this.#i?.(e,t)??1)&&(e.nodeType===t.nodeType&&null!==e.nodeValue&&null!==t.nodeValue?this.#w(e,"nodeValue",t.nodeValue):this.#C(e,t.cloneNode(!0)),this.#d?.(e,t))}#b(e){const[t,o]=e;n(t)?this.#P(e):(t.hasChildNodes()||o.hasChildNodes())&&this.#U(e)}#P([e,t]){const o=new Map,r=t.children.length;for(let e=0;e<r;e++){const r=t.children[e];o.set(r.outerHTML,r)}const i=e.children.length;for(let t=0;t<i;t++){const r=e.children[t],i=r.outerHTML;o.get(i)?o.delete(i):this.#V(r)}for(const t of o.values())this.#E(e,t.cloneNode(!0))}#g([e,t]){for(const{name:o,value:r}of e.attributes)!t.hasAttribute(o)&&(this.#l?.(e,o,null)??1)&&(e.removeAttribute(o),this.#p?.(e,o,r));for(const{name:o,value:r}of t.attributes){const t=e.getAttribute(o);t!==r&&(this.#l?.(e,o,r)??1)&&(e.setAttribute(o,r),this.#p?.(e,o,t))}if(i(e)&&i(t))this.#w(e,"checked",t.checked),this.#w(e,"disabled",t.disabled),this.#w(e,"indeterminate",t.indeterminate),"file"===e.type||this.#o&&document.activeElement===e||this.#r&&e.name===t.name&&e.value!==e.defaultValue||this.#w(e,"value",t.value);else if(d(e)&&d(t))this.#w(e,"selected",t.selected);else if(s(e)&&s(t)&&(!this.#o||document.activeElement!==e)&&(!this.#r||e.name!==t.name||e.value===e.defaultValue)){this.#w(e,"value",t.value);const o=e.firstElementChild;o&&this.#w(o,"textContent",t.value)}}#U(e){const[t,r]=e,i=t.childNodes,d=r.childNodes;for(let e=0;e<d.length;e++){const r=i[e],s=d[e];if(r&&s){const e=[r,s];o(e)?n(e[0])?this.#P(e):this.#S(e,t):this.#A(e)}else s?this.#E(t,s.cloneNode(!0)):r&&this.#V(r)}for(;i.length>d.length;){const e=t.lastChild;e&&this.#V(e)}}#S([e,t],o){if(!(this.#i?.(e,t)??1))return;const i=this.#e.get(t),d=i?[...i]:[];let s=e,n=null;for(;s;){if(r(s)){const r=s.id;if(n||s.localName!==t.localName||(n=s),""!==r){if(r===t.id)return this.#B(o,s,e),this.#N([s,t]);{const r=this.#e.get(s);if(r&&d.some((e=>r.has(e))))return this.#B(o,s,e),this.#N([s,t])}}}s=s.nextSibling}if(n)this.#B(o,n,e),this.#N([n,t]);else{const r=t.cloneNode(!0);(this.#s?.(r)??1)&&(this.#B(o,r,e),this.#n?.(r))}this.#d?.(e,t)}#w(e,t,o){const r=e[t];r!==o&&(this.#f?.(e,t,o)??1)&&(e[t]=o,this.#u?.(e,t,r))}#C(e,t){(this.#a?.(e)??1)&&(this.#s?.(t)??1)&&(e.replaceWith(t),this.#n?.(t),this.#h?.(e))}#B(e,t,o){if(t!==o){if(r(t)){const r=this.#t.get(t)??0;if(r>0){let i=t.previousSibling;for(;i;){if(!((this.#t.get(i)??0)<r))break;if(e.insertBefore(i,t.nextSibling),i===o)return;i=t.previousSibling}}}e.insertBefore(t,o)}}#E(e,t){(this.#s?.(t)??1)&&(e.appendChild(t),this.#n?.(t))}#V(e){(this.#a?.(e)??1)&&(e.remove(),this.#h?.(e))}}function o(e){const[t,o]=e;return r(t)&&r(o)&&t.localName===o.localName}function r(e){return 1===e.nodeType}function i(e){return"input"===e.localName}function d(e){return"option"===e.localName}function s(e){return"textarea"===e.localName}function n(e){return"head"===e.localName}const a=new Set([1,9,11]);function h(e){return a.has(e.nodeType)}